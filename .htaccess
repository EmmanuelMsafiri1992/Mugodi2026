# Mugodi E-commerce App
# Apache configuration for React frontend + Node.js API

# Enable RewriteEngine
RewriteEngine On

# Proxy API requests to Node.js backend (port 5000)
RewriteCond %{REQUEST_URI} ^/api [NC]
RewriteRule ^api/(.*)$ http://localhost:5000/api/$1 [P,L]

# Serve static files from client/dist
RewriteCond %{REQUEST_URI} !^/client/dist/
RewriteCond %{DOCUMENT_ROOT}/client/dist%{REQUEST_URI} -f
RewriteRule ^(.*)$ /client/dist/$1 [L]

# For React Router - serve index.html for all non-file requests
RewriteCond %{REQUEST_URI} !^/api
RewriteCond %{REQUEST_URI} !^/client/dist/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /client/dist/index.html [L]

# Default directory index
DirectoryIndex client/dist/index.html

# Deny access to sensitive directories
<IfModule mod_rewrite.c>
    RewriteRule ^(server|node_modules|\.env|\.git)/ - [F,L]
</IfModule>

# Enable CORS for API if needed
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
</IfModule>

# Disable directory listing
Options -Indexes

# Cache static assets
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>
